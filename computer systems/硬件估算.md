
如何花最少的钱，装下亚马逊的所有商品？

假设有 6 亿件商品，如果每件商品需要 4MB 的存储空间，则共 2400TB（ = 6 亿 × 4MB）的数据存储。

如果把数据都放在内存里面，就需要 3600 万美元（ = 2400TB/1MB × 0.015 美元 = 3600 万美元）。
但是，这 6 亿件商品中，不是每一件商品都会被经常访问。
如果只在内存里放前 1% 的热门商品，也就是 600 万件热门商品，而把剩下的商品放在机械式的 HDD 硬盘上。此时需要的存储成本为 45.6 万美元（ = 3600 万美元 × 1% + 2400TB / 1MB × 0.00004 美元），是原来成本的 1.3% 左右。

那么，只放 600 万件商品真的可以满足实际的线上服务请求吗？这个就要看 LRU 缓存策略的**缓存命中率**（Hit Rate/Hit Ratio）了，也就是访问的数据中，可以在设置的内存缓存中找到的，占有多大比例。

内存的随机访问请求需要 100ns。也就是说内存可以支持每秒 1000 万次随机访问。用了 24TB 内存，如果 8G 一条的话，意味着有 3000 条内存，可以支持每秒 300 亿次（ = 24TB/8GB × 1s/100ns）访问。

假设每天的活跃用户为 1 亿，且每人平均会访问 100 个商品，那么平均每秒访问的商品数量，就是 12 万次。

但是如果数据没有命中内存，那么对应的数据请求就要访问到 HDD 磁盘了。一块 HDD 硬盘只能支撑每秒 100 次的随机访问，2400TB 的数据，以 4TB 一块磁盘来计算，有 600 块磁盘，也就是能支撑每秒 6 万次（ = 2400TB/4TB × 1s/10ms ）的随机访问。

也就说在最坏的情况下，内存至少要 50% 的缓存命中率，HDD 磁盘才能支撑对应的访问次数。不然的话，要么选择添加更多数量的 HDD 硬盘，做到每秒 12 万次的随机访问，或者将 HDD 替换成 SSD 硬盘，让单个硬盘可以支持更多的随机访问请求。
